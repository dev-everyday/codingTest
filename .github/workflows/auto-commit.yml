name: Daily Auto Commit

on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * *'

jobs:
  auto-commit:
    runs-on: ubuntu-latest
    steps:
      - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3

      - name: ì˜¤ëŠ˜ ì»¤ë°‹ ì—¬ë¶€ í™•ì¸
        id: check_commit
        run: |
          DATE=$(TZ=Asia/Seoul date '+%Y-%m-%d')
          echo "ì˜¤ëŠ˜ ë‚ ì§œ: $DATE"
          if git log --since="$DATE 00:00 +0900" --author="$GITHUB_ACTOR" --oneline | grep .; then
            echo "ì˜¤ëŠ˜ ì´ë¯¸ ì»¤ë°‹ì´ ìˆìŠµë‹ˆë‹¤. ì›Œí¬í”Œë¡œë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤."
            echo "should_run=false" >> $GITHUB_OUTPUT
          else
            echo "ì˜¤ëŠ˜ ì»¤ë°‹ì´ ì—†ìŠµë‹ˆë‹¤. ìë™ ì»¤ë°‹ì„ ì§„í–‰í•©ë‹ˆë‹¤."
            echo "should_run=true" >> $GITHUB_OUTPUT
          fi

      - name: íŒŒì¼ ì—…ë°ì´íŠ¸
        if: steps.check_commit.outputs.should_run == 'true'
        run: |
          DATE=$(TZ=Asia/Seoul date '+%Y%m%d')
          echo "DATE=${DATE}" >> $GITHUB_ENV  # DATE ë³€ìˆ˜ë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •
          echo "ğŸŒ¿ì˜¤ëŠ˜ì€ botì´ ì”ë”” ì‹¬ì–´ìš”ğŸŒ¿" > "[${DATE}]"

      - name: ë³€ê²½ ì‚¬í•­ ì»¤ë°‹
        if: steps.check_commit.outputs.should_run == 'true'
        run: |
          echo "ì‚¬ìš© ì¤‘ì¸ DATE ë³€ìˆ˜: ${DATE}"
          git config --global user.name "$GITHUB_ACTOR"
          git config --global user.email "${{ secrets.USER_EMAIL }}"
          ls -l  # í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ ëª©ë¡ í™•ì¸
          git add "[${DATE}]"
          git commit -m "ìë™ ì»¤ë°‹: ${DATE}"

      - name: ìê²© ì¦ëª… ì„¤ì •
        if: steps.check_commit.outputs.should_run == 'true'
        run: |
          git config --global user.name "$GITHUB_ACTOR"
          git config --global user.email "${{ secrets.USER_EMAIL }}"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}

      - name: ë³€ê²½ ì‚¬í•­ í‘¸ì‹œ
        if: steps.check_commit.outputs.should_run == 'true'
        run: |
          git push
